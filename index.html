<!DOCTYPE html>
<html lang="ta">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fuel Savvy Pro - Dilip Final</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        #map { height: 300px; width: 100%; border-radius: 15px; margin-bottom: 15px; }
        .stat-card { background: #1e293b; padding: 15px; border-radius: 20px; border: 1px solid #334155; }
    </style>
</head>
<body class="bg-slate-900 text-white p-4">
    <h1 class="text-xl font-bold text-green-400 mb-4 text-center">Fuel Savvy Pro</h1>

    <div id="map"></div>

    <div class="grid grid-cols-2 gap-3 mb-4">
        <div class="stat-card">
            <p class="text-[10px] text-slate-400">டிஸ்டன்ஸ்</p>
            <p id="distDisplay" class="text-lg font-bold">0.00 km</p>
        </div>
        <div class="stat-card">
            <p class="text-[10px] text-slate-400">லாபம்</p>
            <p id="profitDisplay" class="text-lg font-bold text-green-400">₹0.00</p>
        </div>
    </div>

    <div class="bg-slate-800 p-4 rounded-2xl mb-4">
        <div class="flex gap-2 mb-2">
            <input type="number" id="petrolAmt" placeholder="பெட்ரோல் ₹" class="flex-1 bg-slate-700 p-2 rounded-lg outline-none text-sm">
            <button onclick="savePetrol()" class="bg-blue-600 px-4 py-2 rounded-lg font-bold text-xs">ADD</button>
        </div>
        <p id="historyText" class="text-[10px] text-slate-400 italic">History: இன்னும் சேமிக்கப்படவில்லை</p>
    </div>

    <button id="mainBtn" onclick="toggleTrip()" class="w-full bg-green-500 text-slate-900 font-bold py-4 rounded-2xl text-xl shadow-lg">START TRIP</button>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        let isTripActive = false;
        let startPoint = null;
        let maxDist = 0;
        
        // மேப் செட்டப்
        const map = L.map('map').setView([12.8465, 80.2263], 15);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png').addTo(map);
        let marker = L.marker([12.8465, 80.2263]).addTo(map);

        function toggleTrip() {
            isTripActive = !isTripActive;
            const btn = document.getElementById('mainBtn');
            if(isTripActive) {
                btn.innerText = "FINISH TRIP";
                btn.style.backgroundColor = "#ef4444";
                maxDist = 0;
            } else {
                btn.innerText = "START TRIP";
                btn.style.backgroundColor = "#22c55e";
                alert("பயணம் முடிந்தது!");
            }
        }

        navigator.geolocation.watchPosition(p => {
            const pos = [p.coords.latitude, p.coords.longitude];
            marker.setLatLng(pos);
            map.setView(pos);
            
            if(!startPoint) startPoint = pos;
            if(!isTripActive) return;

            let distMeters = map.distance(pos, startPoint);
            let distKm = distMeters / 1000;
            
            // ரிட்டன் லாஜிக்: தூரம் குறைய ஆரம்பித்தால் ₹5 கணக்கு
            let currentProfit = 0;
            if (distMeters > maxDist) {
                maxDist = distMeters;
                currentProfit = distKm * 10; // போகும்போது ₹10
            } else {
                currentProfit = distKm * 5; // வரும்போது ₹5
            }

            document.getElementById('distDisplay').innerText = distKm.toFixed(2) + " km";
            document.getElementById('profitDisplay').innerText = "₹" + currentProfit.toFixed(2);
        }, null, {enableHighAccuracy: true});

        function savePetrol() {
            let amt = document.getElementById('petrolAmt').value;
            if(!amt) return;
            document.getElementById('historyText').innerText = "கடைசியாக சேர்த்தது: ₹" + amt;
            alert("சேமிக்கப்பட்டது!");
        }
    </script>
</body>
</html>
